
\documentclass[a4paper,11pt]{article}

\input{../styles/article_preamble}
\input{../styles/tikz_preamble}

\sybtitle{同步、异步，阻塞、非阻塞}
\sybauthor{孙延宾}
\sybdate{\today}

\begin{document}
\tt % I love Typewriter font.
%%%%%%%% the title page and toc %%%%%%%%%%
\pagestyle{header}
\sybmaketitle
%\tableofcontents
\newpage

%%%%%%% the main content %%%%%%%%%
\pagestyle{main}
\setcounter{page}{1}

\section[术语]{术语}
\begin{itemize}
  \item 同步：synchronize
  \item 异步：asynchronize
  \item 阻塞：block
  \item 非阻塞：nonblock
\end{itemize}

\section[一个故事]{一个故事}
故事来源于网络，作者未知。

老张爱喝茶，经常烧水沏茶。下面是他烧水时的情景，
\begin{description}
  \item[情形1: ] 烧上水，然后站在炉灶前什么都不干，盯着水壶等水烧开。
  \item[情形2: ] 烧上水，然后发呆(或瞌睡)一会儿、检查水壶，再发呆一会儿、检查水壶，直到水烧开。
\end{description}
不论哪种情形，老张都要等到水烧开了才会做其他事情。

可是这样烧水实在太浪费时间，老张决定换种方式。他想水烧上之后不必一定等水开了才做其他事情，
毕竟水烧开需要一段时间，这段时间他完全可以做点儿别的，于是老张作了一下调整，
\begin{description}
  \item[情形3: ] 烧上水，然后浇花、检查水壶，喂鸟、检查水壶，看会儿电视、检查水壶....
\end{description}
这样，在烧水的这段时间里老张又做了很多事情。可是老张仍然觉得不满意，一次次检查水壶，
让他感觉很累人，还有没有别的方法呢？于是老张换了一个带哨子的水壶，水烧开后自动鸣哨，
这样他就不用一次次检查水壶了，
\begin{description}
  \item[情形4: ] 烧上水，然后浇花、喂鸟、(安心的)看电视，水烧开后自动鸣哨通知老张。
\end{description}

\section[抽象理解]{抽象理解}
\emph{同步、异步}是描述“消息通知方式”的。调用者发起调用，被调用者执行并结果返回给调用者。
我们以函数调用为例，当然也可以是网络通讯、文件IO等等。
\begin{itemize}
  \item 调用者发起函数调用，直到收到被调用者的执行结果，这期间不进行其他函数调用，此为同步。如情形1、情形2
  \item 调用者发起函数调用，直到收到被调用者的执行结果，这期间进行其他函数调用(提供效率啊)，此为异步。
        异步需要额外的机制来确保调用者收到被调用者的结果，可以是轮询(如情形3)，可以是回调(如情形4)，也可以是其他机制。
\end{itemize}
更通俗一点儿说，同步是顺序演进而异步是乱序演进。

这里的执行结果不是函数返回值，而是实际想要的结果(如果文件读取时的数据)。

但是，无论同步还是异步，被调用者执行函数而得到结果所需的时间是固定的，同步调用时，
这期间调用者没有其他函数调用，那它会有怎样的行为呢？
\begin{itemize}
  \item 在此期间，调用者什么都不做，死等，那么就说发起者是阻塞的。如情形1
  \item 在此期间，调用者一次次检查是否有结果到来，那么就说发起者是非阻塞的。如情形2
\end{itemize}
由此可见，

\emph{阻塞、非阻塞}是描述发起者“等待状态”的。同步通讯时，调用者在等待期间可以阻塞也可以非阻塞，
阻塞与否只关乎调用者而与被调用者无关。而同步、异步的区分似乎也只跟调用者是否开启新任务有关，实则
不然，因为通过回调方式实现异步通讯时也需要被调用者配合。轮询(情形3中的轮询而非情形2中的轮询)、
回调、Event Loop都是异步通讯的实现方式。

总结，同步、异步，阻塞、非阻塞是两组概念，他们的关注点不同而使得他们之间没有任何关系，
当然两组之间可以搭配使用，没有必要强行比对这两组概念。

注意：异步通讯时，调用者也可以阻塞自己等待结果，但是，太傻了是不是？！

\end{document}
